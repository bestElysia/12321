<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ— å°½ä¿®ä»™ï¼šé€†å¤©æ”¹å‘½</title>
    <style>
        /* =========================================
           CSS æ ·å¼è¡¨
           ========================================= */
        :root {
            --bg-color: #000;
            --panel-bg: #111;
            --card-bg: rgba(30, 30, 40, 0.6);
            --primary-gold: #ffc107;
            --primary-green: #00e676;
            --danger-red: #ff3b30;
            --neon-blue: #00f2ff;
            --rare-purple: #d500f9;
            --god-tier: #ff0055;
            --text-main: #f0f0f0;
            --text-dim: #888;
            --border-color: #333;
        }

        * { box-sizing: border-box; user-select: none; -webkit-touch-callout: none; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            overflow: hidden;
            height: 100vh; width: 100vw;
            display: flex; justify-content: center;
            background: #000;
            touch-action: none;
        }

        .bg-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }

        #app {
            position: relative; z-index: 10; width: 100%; max-width: 600px; height: 100%;
            display: flex; flex-direction: column;
            background: radial-gradient(circle at center, rgba(20,20,30,0.5) 0%, rgba(0,0,0,1) 100%);
        }

        /* --- ä¸ŠåŠéƒ¨ï¼šæ ¸å¿ƒç‚¹å‡»åŒº --- */
        #click-area {
            height: 38%; 
            position: relative; display: flex; flex-direction: column;
            justify-content: center; align-items: center; cursor: pointer;
            transition: background 0.2s; touch-action: manipulation;
            padding-bottom: 20px; /* ç»™åº•éƒ¨ç•™ç‚¹ç©ºé—´ */
        }
        #click-area:active { background: rgba(255, 255, 255, 0.03); }

        .avatar-container {
            width: 130px; height: 130px; border-radius: 50%;
            border: 2px solid #444;
            display: flex; justify-content: center; align-items: center;
            position: relative; transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            background: radial-gradient(circle, #2a2a2a, #050505);
            box-shadow: 0 0 25px rgba(0,0,0,0.8); z-index: 20;
            margin-bottom: 20px;
        }
        .avatar-container.channeling {
            border-color: var(--neon-blue); box-shadow: 0 0 60px var(--neon-blue); transform: scale(1.05);
        }
        .meditate-icon { font-size: 3.5rem; transition: transform 0.1s; }

        .realm-badge {
            position: absolute; bottom: -14px;
            background: linear-gradient(90deg, #000, #333, #000);
            border: 1px solid var(--primary-gold); color: var(--primary-gold);
            padding: 4px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: bold;
            box-shadow: 0 0 15px rgba(255, 193, 7, 0.2); white-space: nowrap;
        }

        /* è¿›åº¦æ¡ */
        .channel-bar { margin-bottom: 15px; width: 60%; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; position: relative; opacity: 0; }
        .channel-bar.active { opacity: 1; }
        .channel-fill { height: 100%; background: var(--neon-blue); width: 0%; border-radius: 2px; box-shadow: 0 0 10px var(--neon-blue); }
        .channel-info { 
            position: absolute; top: -20px; width: 100%; text-align: center;
            font-size: 0.8rem; color: var(--neon-blue); height: 16px; opacity: 0.9; text-shadow: 0 0 5px black;
        }

        /* --- æ–°å¢ï¼šæ“ä½œçŠ¶æ€æ  (èƒ¶å›Š) --- */
        .status-pill {
            width: 85%;
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid #333;
            border-radius: 40px;
            padding: 10px 20px;
            display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .status-left { font-size: 0.8rem; color: #888; display: flex; align-items: center; }
        .status-right { text-align: right; }
        
        .spirit-label-xs { font-size: 0.65rem; color: #555; display: block; line-height: 1; margin-bottom: 2px;}
        .spirit-val-pill { 
            font-family: 'Courier New', monospace; 
            font-size: 1.4rem; color: var(--primary-green); font-weight: 800; 
            text-shadow: 0 0 10px rgba(0, 230, 118, 0.2);
            line-height: 1;
        }

        /* --- ä¸‹åŠéƒ¨ï¼šå¤§é¢æ¿ --- */
        #panel-container { 
            flex: 1; 
            background: var(--panel-bg); 
            border-top: 1px solid #222; 
            border-radius: 20px 20px 0 0;
            display: flex; flex-direction: column;
            box-shadow: 0 -5px 30px rgba(0,0,0,0.8);
            overflow: hidden;
        }
        
        .tabs { display: flex; background: rgba(0,0,0,0.3); border-bottom: 1px solid #222; padding: 0 10px; }
        .tab-btn {
            flex: 1; padding: 15px 0; background: transparent; border: none; color: #666;
            font-size: 0.95rem; font-weight: bold; cursor: pointer; position: relative;
        }
        .tab-btn.active { color: var(--primary-gold); }
        .tab-btn.active::after {
            content: ''; position: absolute; bottom: 0; left: 25%; width: 50%; height: 3px; 
            background: var(--primary-gold); border-radius: 3px 3px 0 0; box-shadow: 0 -2px 10px rgba(255, 193, 7, 0.5);
        }

        .tab-content { 
            flex: 1; overflow-y: auto; padding: 15px; 
            padding-bottom: 80px; 
            display: none; -webkit-overflow-scrolling: touch; 
        }
        .tab-content.show { display: block; animation: fadeIn 0.3s; }

        /* è§’è‰²å¡ç‰‡ */
        .dashboard-card {
            background: linear-gradient(135deg, #222, #1a1a1a);
            border: 1px solid #333;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .dash-row { grid-column: span 2; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 8px; margin-bottom: 8px; }
        .dash-item { display: flex; flex-direction: column; }
        .dash-label { font-size: 0.7rem; color: #666; margin-bottom: 4px; }
        .tag-badge { 
            display: inline-block; font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; 
            background: rgba(255,255,255,0.05); border: 1px solid #444; color: #aaa;
        }
        .tag-badge.god { border-color: var(--god-tier); color: var(--god-tier); background: rgba(255,0,85,0.1); }
        .tag-badge.rare { border-color: var(--rare-purple); color: var(--rare-purple); background: rgba(213,0,249,0.1); }

        .quick-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .btn-onekey {
            background: linear-gradient(90deg, #2196f3, #00e5ff); color: #000; border: none;
            padding: 8px 20px; border-radius: 20px; font-size: 0.85rem; font-weight: 800;
            box-shadow: 0 0 15px rgba(33, 150, 243, 0.4); cursor: pointer;
            transition: transform 0.1s;
        }
        .btn-onekey:active { transform: scale(0.95); }

        .list-item {
            background: #181818; border: 1px solid #2a2a2a;
            padding: 12px; margin-bottom: 8px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .btn-upgrade {
            min-width: 80px; text-align: center;
            background: transparent; border: 1px solid var(--primary-green); color: var(--primary-green);
            padding: 6px 0; border-radius: 6px; font-size: 0.8rem; cursor: pointer;
        }
        .btn-upgrade:disabled { border-color: #333; color: #444; }
        .btn-upgrade.maxed { border-color: var(--primary-gold); color: var(--primary-gold); background: rgba(255,215,0,0.05); }

        .cultivate-btn-lg {
            width: 100%; padding: 14px; border: none; font-size: 1rem; font-weight: bold; border-radius: 8px; 
            margin-top: 8px; cursor: pointer; touch-action: manipulation;
            background: #222; color: #888;
        }
        .cultivate-btn-lg.active { background: var(--primary-green); color: #000; }
        .cultivate-btn-lg.active.risk { background: linear-gradient(45deg, #ff9800, #ff5722); color: white; }
        .cultivate-btn-lg.trib { 
            background: linear-gradient(45deg, #d32f2f, #b71c1c); color: #fff; animation: pulse 1.5s infinite; 
            box-shadow: 0 0 20px rgba(211, 47, 47, 0.4);
        }

        .float-text {
            position: absolute; color: #fff; font-weight: bold; pointer-events: none;
            animation: floatUp 0.8s forwards; font-size: 1.4rem; text-shadow: 2px 2px 0 #000; z-index: 100;
        }

        /* éšè—ä¿åº•æ˜¾ç¤º */
        .pity-tag { display: none !important; }

        #tribulation-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.96); z-index: 2000;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .thunder-bolt {
            position: absolute; top: 0; left: 50%; width: 6px; height: 100%;
            background: #fff; box-shadow: 0 0 40px #fff, 0 0 100px #7b1fa2;
            transform: translateX(-50%) scaleY(0); transform-origin: top; opacity: 0;
        }
        .thunder-strike { animation: strike 0.08s; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-80px) scale(1.2); opacity: 0; } }
        @keyframes strike { 0% { transform: translateX(-50%) scaleY(0); opacity: 1; } 50% { transform: translateX(-50%) scaleY(1); opacity: 1; } 100% { transform: translateX(-50%) scaleY(1); opacity: 0; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

        .hidden { display: none !important; }
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85);
            display: flex; justify-content: center; align-items: center; z-index: 3000; backdrop-filter: blur(8px);
        }
        .modal-box {
            background: #1a1a1a; padding: 30px; border-radius: 16px; border: 1px solid var(--border-color);
            text-align: center; width: 85%; max-width: 360px; box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }
        input { background: #222; border: 1px solid #444; color: white; padding: 12px; margin: 20px 0; width: 100%; text-align: center; border-radius: 6px; font-size: 1.1rem;}
    </style>
</head>
<body>

    <canvas id="bgCanvas" class="bg-canvas"></canvas>

    <div id="app">
        <div id="click-area">
            <div class="avatar-container" id="avatar">
                <div class="meditate-icon">ğŸ§˜â€â™‚ï¸</div>
                <div class="realm-badge" id="realm-disp">ç‚¼æ°”æœŸ ä¸€å±‚</div>
            </div>
            
            <div id="channel-container" class="channel-bar">
                <div class="channel-info" id="channel-text"></div>
                <div class="channel-fill" id="channel-fill"></div>
            </div>

            <div class="status-pill">
                <div class="status-left">
                    <span style="font-size:1.2rem; margin-right:8px;">ğŸ‘†</span>
                    <div>é•¿æŒ‰<br><span style="color:var(--neon-blue)">æ±‡èšçµæ°”</span></div>
                </div>
                <div class="status-right">
                    <span class="spirit-label-xs">å½“å‰çµåŠ›</span>
                    <span class="spirit-val-pill" id="spirit-disp">0</span>
                </div>
            </div>
        </div>

        <div id="panel-container">
            <div class="tabs">
                <button class="tab-btn active" onclick="ui.switchTab('skills')">åŠŸæ³•ç§˜ç±</button>
                <button class="tab-btn" onclick="ui.switchTab('cultivate')">æ´åºœä¿®ç‚¼</button>
                <button class="tab-btn" onclick="ui.switchTab('log')">ä»™é€”æ—¥å¿—</button>
            </div>

            <div id="tab-skills" class="tab-content show">
                <div class="dashboard-card">
                    <div class="dash-row">
                        <div><span style="color:#666">é“å·:</span> <span id="player-name" style="color:var(--primary-gold); font-weight:bold;">é“å‹</span></div>
                        <div style="font-size:0.75rem; color:#666">ç¬¬ <span id="reincarnate-count" style="color:#eee">0</span> ä¸–è½®å›</div>
                    </div>
                    <div class="dash-item">
                        <span class="dash-label">çµæ ¹èµ„è´¨</span>
                        <div id="talent-disp" class="tag-badge">å‡¡å“</div>
                    </div>
                    <div class="dash-item" style="align-items: flex-end;">
                        <span class="dash-label">æœ¬å‘½æ³•å®</span>
                        <div id="weapon-disp" class="tag-badge">é“å‰‘</div>
                    </div>
                </div>

                <div class="quick-actions">
                    <span style="font-size:0.75rem;color:#666;">è‡³è‡»Â·åŠŸæ³•å¯æŠµå¾¡å¤©åŠ«</span>
                    <button class="btn-onekey" onclick="game.upgradeAllSkills()">âš¡ ä¸€é”®å‡çº§</button>
                </div>
                <div id="skills-list"></div>
            </div>

            <div id="tab-cultivate" class="tab-content">
                <div style="background:#1a1a1a; padding:15px; border-radius:8px; margin-bottom:15px; border:1px solid #333;">
                    <div class="cultivate-header">
                        <span>å¢ƒç•Œçªç ´ <span style="font-size:0.7rem; color:#888;">(æˆåŠŸç‡80%)</span></span>
                        <span id="next-realm-name" style="color:var(--primary-gold)">ç‚¼æ°”æœŸ äºŒå±‚</span>
                    </div>
                    <div style="font-size:0.8rem; color:#666; margin-bottom:8px;">æ‰€éœ€çµåŠ›: <span id="req-realm" style="color:#fff">100</span></div>
                    
                    <button id="btn-realm" class="cultivate-btn-lg" onclick="game.upgradeRealm()">çªç ´ç“¶é¢ˆ (80%)</button>
                    <button id="btn-trib" class="cultivate-btn-lg trib hidden" onclick="game.startTribulation()">é€†å¤©æ”¹å‘½ (ç™¾é›·å¤©åŠ«)</button>
                    
                    <div id="trib-warn" class="hidden" style="margin-top:10px; background:rgba(255,59,48,0.1); padding:8px; border-radius:4px; border:1px solid rgba(255,59,48,0.3);">
                        <div style="color:#ff3b30; font-size:0.75rem; font-weight:bold; margin-bottom:4px;">âš ï¸ å¤©åŠ«é¢„è­¦</div>
                        <div style="color:#aaa; font-size:0.7rem; line-height:1.4;">
                            é›·åŠ«å…±100é“ï¼Œå¨åŠ›é€çº§é€’å¢ã€‚<br>
                            å½“å‰æŠ¤ä½“å€¼: <span id="protect-val-preview" style="color:#fff; font-weight:bold;">0%</span> (åŠŸæ³•+çµæ ¹+æ³•å®)
                        </div>
                    </div>
                </div>

                <div style="margin-bottom:15px; padding-bottom:15px; border-bottom:1px dashed #333;">
                    <div class="cultivate-header">
                        <span>æ·¬ç‚¼çµæ ¹ <span style="font-size:0.7rem; color:#888;">(æˆåŠŸç‡80%)</span></span>
                        <span id="pity-root" class="pity-tag">ä¿åº• 0/10</span>
                    </div>
                    <div style="font-size:0.8rem; color:#666; margin-bottom:5px; display:flex; justify-content:space-between;">
                        <span>ä¸‹é˜¶: <span id="next-root-name" style="color:var(--neon-blue)">ä¸‹å“çµæ ¹</span></span>
                        <span id="root-bonus" style="color:var(--primary-green)"></span>
                    </div>
                    <div style="font-size:0.8rem; color:#666;">æ¶ˆè€—: <span id="req-root" style="color:#fff">500</span></div>
                    <button id="btn-root" class="cultivate-btn-lg" onclick="game.upgradeRoot()">æ´—é«“ä¼éª¨ (èµŒ!)</button>
                </div>

                <div style="margin-bottom:15px;">
                    <div class="cultivate-header">
                        <span>ç¥­ç‚¼æ³•å® <span style="font-size:0.7rem; color:#888;">(æˆåŠŸç‡80%)</span></span>
                        <span id="pity-weapon" class="pity-tag">ä¿åº• 0/10</span>
                    </div>
                    <div style="font-size:0.8rem; color:#666; margin-bottom:5px; display:flex; justify-content:space-between;">
                        <span>ä¸‹é˜¶: <span id="next-weapon-name" style="color:var(--rare-purple)">æœ¨å‰‘</span></span>
                        <span id="weapon-bonus" style="color:var(--primary-green)"></span>
                    </div>
                    <div style="font-size:0.8rem; color:#666;">æ¶ˆè€—: <span id="req-weapon" style="color:#fff">1,000</span></div>
                    <button id="btn-weapon" class="cultivate-btn-lg" onclick="game.upgradeWeapon()">ç¥­ç‚¼æ³•å® (èµŒ!)</button>
                </div>
            </div>

            <div id="tab-log" class="tab-content">
                <div id="gamelog" style="font-size: 0.75rem; line-height: 1.8; color: #888;"></div>
            </div>
        </div>
    </div>

    <div id="modal-start" class="modal">
        <div class="modal-box">
            <h2 style="color: var(--primary-gold); margin-top:0;">è¸å…¥ä»™é€”</h2>
            <p style="color:#888;font-size:0.85rem; margin-bottom:20px;">å‡¡äººä¿®ä»™ï¼Œé€†å¤©æ”¹å‘½</p>
            <input type="text" id="inp-name" placeholder="è¯·è¾“å…¥é“å·" maxlength="6">
            <button class="cultivate-btn-lg active" onclick="game.startGame()">å¼€å§‹ä¿®ä»™</button>
        </div>
    </div>

    <div id="tribulation-overlay" class="hidden">
        <div class="thunder-bolt" id="thunder-vfx"></div>
        <div style="z-index: 2002; text-align: center; width: 85%;">
            <h1 style="color: #ffeb3b; text-shadow: 0 0 20px red; font-size:2.5rem; margin:0 0 20px 0;">å¤©åŠ«é™ä¸´</h1>
            
            <div style="display:flex; justify-content:space-between; width:100%; margin-bottom:5px; font-size:0.8rem; color:#aaa;">
                <span>æŠ¤ä½“çµå…‰</span>
                <span id="trib-hp-text">100%</span>
            </div>
            <div style="width:100%; background:#333; height:8px; border-radius:4px; margin-bottom:20px; overflow:hidden;">
                <div id="trib-hp-bar" style="width:100%; height:100%; background:linear-gradient(90deg, #00e676, #69f0ae); transition: width 0.1s;"></div>
            </div>

            <h2 id="trib-step" style="color: white; font-family: monospace; font-size:1.5rem; margin-bottom:20px;">å‡†å¤‡æŠ—åŠ«</h2>
            
            <div id="trib-console" style="height: 160px; overflow-y: scroll; background: rgba(0,0,0,0.5); border: 1px solid #444; padding: 15px; font-size: 0.75rem; text-align: left; border-radius:8px;"></div>
        </div>
    </div>

    <div id="modal-end" class="modal hidden">
        <div class="modal-box">
            <h1 id="end-title" style="color: #ff3b30; margin-top:0;">é™¨è½</h1>
            <p id="end-desc" style="color:#bbb; margin:20px 0;">ä¿®ä»™è·¯æ¼«æ¼«ï¼Œè¯·é‡æ–°æ¥è¿‡ã€‚</p>
            <button class="cultivate-btn-lg active" onclick="game.reincarnate()">è½¬ä¸–é‡ä¿®</button>
        </div>
    </div>

<script>
const CONFIG = {
    MAJOR_REALMS: [
        { name: "ç‚¼æ°”æœŸ", baseReq: 100, exp: 1.5 },     
        { name: "ç­‘åŸºæœŸ", baseReq: 10000, exp: 1.6 },    
        { name: "é‡‘ä¸¹æœŸ", baseReq: 500000, exp: 1.7 },   
        { name: "å…ƒå©´æœŸ", baseReq: 10000000, exp: 1.8 },  
        { name: "åŒ–ç¥æœŸ", baseReq: 500000000, exp: 1.9 },
        { name: "ç‚¼è™šæœŸ", baseReq: 20000000000, exp: 2.0 }, 
        { name: "åˆä½“æœŸ", baseReq: 500000000000, exp: 2.1 }, 
        { name: "å¤§ä¹˜æœŸ", baseReq: 10000000000000, exp: 2.2 }, 
        { name: "æ¸¡åŠ«æœŸ", baseReq: 500000000000000, exp: 2.3 }, 
        { name: "é™†åœ°çœŸä»™", baseReq: 0, exp: 1 }
    ],
    // çµæ ¹ï¼š10çš„Næ¬¡æ–¹å€ç‡
    ROOTS: [
        { name: "å‡¡å“åºŸçµæ ¹", mult: 1, cost: 0, tag: 'å‡¡å“' },
        { name: "ä¸‹å“çµæ ¹", mult: 10, cost: 1000, tag: 'ä¸‹å“' },
        { name: "ä¸­å“çµæ ¹", mult: 100, cost: 50000, tag: 'ä¸­å“' },
        { name: "ä¸Šå“çµæ ¹", mult: 1000, cost: 1000000, tag: 'ä¸Šå“' },
        { name: "åœ°çµæ ¹", mult: 10000, cost: 20000000, tag: 'åœ°å“' },
        { name: "å¤©çµæ ¹", mult: 100000, cost: 500000000, tag: 'å¤©å“' },
        { name: "æå“å¤©çµæ ¹", mult: 1000000, cost: 10000000000, tag: 'æå“' },
        { name: "å˜å¼‚é›·çµæ ¹", mult: 10000000, cost: 500000000000, tag: 'å˜å¼‚' },
        { name: "ä»™çµæ ¹", mult: 100000000, cost: 10000000000000, tag: 'ä»™å“' },
        { name: "ç»ä¸–æ— åŒ", mult: 1000000000, cost: 999999999999999, tag: 'ç»ä¸–' } 
    ],
    // æ³•å®ï¼š10çš„Næ¬¡æ–¹å€ç‡
    WEAPONS: [
        { name: "ç ´æ ‘æ", mult: 1, cost: 0, tag: 'å‡¡é“' },
        { name: "ç”Ÿé”ˆé“å‰‘", mult: 10, cost: 5000, tag: 'å‡¡é“' },
        { name: "ç²¾é’¢å‰‘", mult: 100, cost: 100000, tag: 'å‡¡é“' },
        { name: "å¯’é“å‰‘", mult: 1000, cost: 2000000, tag: 'çµå™¨' },
        { name: "é’é”‹å‰‘", mult: 10000, cost: 50000000, tag: 'çµå™¨' },
        { name: "ç¢§æ°´å‰‘", mult: 100000, cost: 1000000000, tag: 'æ³•å®' },
        { name: "çœŸÂ·ç¢§æ°´å‰‘", mult: 1000000, cost: 50000000000, tag: 'æ³•å®' },
        { name: "ç¢§æ°´å‰‘ (æ)", mult: 10000000, cost: 2000000000000, tag: 'å¤å®' },
        { name: "ç¢§æ°´å‰‘ (è‡»)", mult: 100000000, cost: 100000000000000, tag: 'çµå®' },
        { name: "è½©è¾•å‰‘", mult: 1000000000, cost: 9999999999999999, tag: 'ç¥å™¨' }
    ],
    SKILLS: [
        { name: "åŸºç¡€åçº³", cost: 100, power: 1.1, desc: "ä¿®ä»™å…¥é—¨" },
        { name: "æ¸…å°˜æœ¯", cost: 5000, power: 1.15, desc: "èº«æ— å°˜å¢" },
        { name: "æ°´çƒæœ¯", cost: 50000, power: 1.2, desc: "å¨åŠ›æƒŠäºº" },
        { name: "å¤§æ°´çƒæœ¯", cost: 500000, power: 1.25, desc: "ç‰¹åˆ«å¤§çš„æ°´çƒ" },
        { name: "ç¢§æ°´å¿ƒæ³•", cost: 5000000, power: 1.3, desc: "ä¸Šå–„è‹¥æ°´" },
        { name: "ç¢§æ°´å‰‘æ³•", cost: 50000000, power: 1.35, desc: "å‰‘æ°”å¦‚æ°´" },
        { name: "å¤§è¡é¾Ÿæ¯å†³", cost: 200000000, power: 1.4, desc: "å¯¿å‘½æé•¿" },
        { name: "çƒˆç«ç‡åŸè¯€", cost: 1000000000, power: 1.45, desc: "ç«ç³»éœ¸é“" },
        { name: "åšåœŸé‡‘é’Ÿç½©", cost: 5000000000, power: 1.5, desc: "ä¸åŠ¨å¦‚å±±" },
        { name: "é’æœ¨é•¿ç”ŸåŠŸ", cost: 20000000000, power: 1.55, desc: "è‰æœ¨ç²¾æ°”" },
        { name: "åºšé‡‘ç™½è™æ€", cost: 100000000000, power: 1.6, desc: "ä¸»æ€ä¼" },
        { name: "ç´«æ°”ä¸œæ¥", cost: 500000000000, power: 1.65, desc: "å¸æ”¶ç´«æ°”" },
        { name: "å¤ªä¸Šæ„Ÿåº”ç¯‡", cost: 2000000000000, power: 1.7, desc: "å¤ºå¤©åœ°é€ åŒ–" },
        { name: "åŒ—å†¥ç¥åŠŸ", cost: 10000000000000, power: 1.75, desc: "åå™¬ä¸‡ç‰©" },
        { name: "å…«ä¹ç„åŠŸ", cost: 50000000000000, power: 1.8, desc: "è‚‰èº«æˆåœ£" },
        { name: "è¢–é‡Œä¹¾å¤", cost: 200000000000000, power: 1.85, desc: "è£…å°½å¤©ä¸‹" },
        { name: "çœŸÂ·åƒåƒåƒ", cost: 1000000000000000, power: 1.9, desc: "åƒå°±èƒ½å˜å¼º" },
        { name: "åå¤©é­”åŠŸ", cost: 5000000000000000, power: 1.95, desc: "åå™¬è¯¸ç‹" },
        { name: "ä¸€å¿µèŠ±å¼€", cost: 20000000000000000, power: 2.0, desc: "å›ä¸´å¤©ä¸‹" },
        { name: "ä¸‡å‰‘å½’å®—", cost: 100000000000000000, power: 2.1, desc: "å‰‘é“è‡³é«˜" }
    ]
};

const game = {
    data: {
        name: "æ— å",
        spirit: 0,
        realmIdx: 0, layer: 1, 
        rootIdx: 0, 
        weaponIdx: 0,
        skills: CONFIG.SKILLS.map(s => ({...s, level: 0})),
        reincarnationCount: 0,
        isTribulating: false,
        rootFails: 0,
        weaponFails: 0
    },
    
    hold: { active: false, startTime: 0, timer: null, currentMult: 1 },

    init() { ui.init(); this.loop(); },

    startGame() {
        const n = document.getElementById('inp-name').value.trim();
        if(n) this.data.name = n;
        document.getElementById('modal-start').classList.add('hidden');
        ui.log(`é“å‹ <b>${this.data.name}</b> è¸å…¥ä»™é€”ã€‚`);
        ui.render();
    },

    getClickPower() {
        const base = Math.pow(this.data.realmIdx + 1, 3) * this.data.layer;
        let skillMult = 1;
        this.data.skills.forEach(s => {
            if(s.level > 0) skillMult *= Math.pow(s.power, s.level);
        });
        const rootMult = CONFIG.ROOTS[this.data.rootIdx].mult;
        const weaponMult = CONFIG.WEAPONS[this.data.weaponIdx].mult;
        const holdMult = this.hold.currentMult;

        return base * skillMult * rootMult * weaponMult * holdMult;
    },

    processClick(e) {
        if(this.data.isTribulating) return;
        const gain = this.getClickPower();
        this.data.spirit += gain;
        
        const isAuto = !e; 
        if(!isAuto && e.isTrusted) {
            ui.showFloatText(e.clientX, e.clientY, gain);
            ui.bgParticle(e.clientX, e.clientY);
        } else if (isAuto) {
            if(Math.random() > 0.7) {
                const x = window.innerWidth / 2 + (Math.random()*60 - 30);
                const y = window.innerHeight * 0.3 + (Math.random()*40 - 20);
                ui.showFloatText(x, y, gain);
            }
        }
        ui.updateSpirit();
    },

    upgradeAllSkills() {
        let upgraded = false;
        let attempts = 0;
        while(attempts < 20) {
            let passUpgraded = false;
            this.data.skills.forEach(s => {
                const cost = s.cost * Math.pow(1.6, s.level);
                if(s.level < 100 && this.data.spirit >= cost) {
                    this.data.spirit -= cost;
                    s.level++;
                    passUpgraded = true;
                    upgraded = true;
                }
            });
            if(!passUpgraded) break;
            attempts++;
        }
        
        if(upgraded) {
            ui.log("ä¸€é”®å‡çº§å®Œæˆ", "var(--neon-blue)");
            ui.renderSkills();
            ui.renderCultivate();
            ui.updateSpirit();
        } else {
            ui.log("çµåŠ›ä¸è¶³ï¼Œæ— æ³•æå‡", "#666");
        }
    },

    upgradeSkill(idx) {
        const s = this.data.skills[idx];
        const cost = s.cost * Math.pow(1.6, s.level);
        if(this.data.spirit >= cost) {
            this.data.spirit -= cost;
            s.level++;
            return true;
        }
        return false;
    },

    // çµæ ¹å‡çº§ï¼š80% æ¦‚ç‡
    upgradeRoot() {
        if(this.data.rootIdx >= CONFIG.ROOTS.length - 1) return;
        const next = CONFIG.ROOTS[this.data.rootIdx + 1];
        if(this.data.spirit >= next.cost) {
            this.data.spirit -= next.cost;
            
            // 80% æ¦‚ç‡ æˆ–è€… ä¿åº•10æ¬¡
            const success = (Math.random() < 0.8) || (this.data.rootFails >= 9);
            
            if(success) {
                this.data.rootIdx++;
                this.data.rootFails = 0;
                ui.log(`æ´—é«“æˆåŠŸï¼çµæ ¹è¿›é˜¶ä¸º [${next.name}]ï¼`, 'neon-blue');
            } else {
                this.data.rootFails++;
                ui.log(`æ´—é«“å¤±è´¥ï¼Œæ°”è¡€ç¿»æ¶Œ...`, '#ff5722');
            }
            ui.render();
        }
    },

    // æ³•å®å‡çº§ï¼š80% æ¦‚ç‡
    upgradeWeapon() {
        if(this.data.weaponIdx >= CONFIG.WEAPONS.length - 1) return;
        const next = CONFIG.WEAPONS[this.data.weaponIdx + 1];
        if(this.data.spirit >= next.cost) {
            this.data.spirit -= next.cost;
            
            // 80% æ¦‚ç‡ æˆ–è€… ä¿åº•10æ¬¡
            const success = (Math.random() < 0.8) || (this.data.weaponFails >= 9);
            
            if(success) {
                this.data.weaponIdx++;
                this.data.weaponFails = 0;
                ui.log(`ç¥­ç‚¼æˆåŠŸï¼æ³•å®æ™‹å‡ä¸º [${next.name}]ï¼`, 'rare-purple');
            } else {
                this.data.weaponFails++;
                ui.log(`ç¥­ç‚¼å¤±è´¥ï¼ŒçµææŸæ¯...`, '#ff5722');
            }
            ui.render();
        }
    },

    // å¢ƒç•Œçªç ´ï¼šç°åœ¨ä¹Ÿæœ‰ 80% æ¦‚ç‡ï¼ˆå¤©åŠ«é™¤å¤–ï¼‰
    upgradeRealm() {
        const nextReq = this.getNextRealmReq();
        if(this.data.spirit >= nextReq) {
            this.data.spirit -= nextReq;
            
            // å¢åŠ  80% åˆ¤å®š
            if(Math.random() < 0.8) {
                if(this.data.layer < 9) {
                    this.data.layer++;
                    ui.log(`çªç ´è‡³ [${CONFIG.MAJOR_REALMS[this.data.realmIdx].name} ${this.data.layer}å±‚]`, 'green');
                } else {
                    if(this.data.realmIdx === 8 && this.data.layer === 9) return; 
                    this.data.realmIdx++;
                    this.data.layer = 1;
                    ui.log(`=== æ™‹å‡ [${CONFIG.MAJOR_REALMS[this.data.realmIdx].name}] ===`, 'gold');
                }
            } else {
                ui.log("çªç ´ç“¶é¢ˆå¤±è´¥ï¼ŒçµåŠ›é€¸æ•£...", "#ff3b30");
            }
            ui.render();
        }
    },

    getNextRealmReq() {
        const major = CONFIG.MAJOR_REALMS[this.data.realmIdx];
        if(!major) return 0;
        return major.baseReq * Math.pow(this.data.layer, major.exp);
    },

    getProtectionScore() {
        const totalSkills = this.data.skills.length;
        const maxedSkills = this.data.skills.filter(s => s.level >= 100).length;
        const skillScore = (maxedSkills / totalSkills) * 50;
        const rootProgress = this.data.rootIdx / (CONFIG.ROOTS.length - 1);
        const rootScore = rootProgress * 25;
        const weaponProgress = this.data.weaponIdx / (CONFIG.WEAPONS.length - 1);
        const weaponScore = weaponProgress * 25;
        return Math.min(100, skillScore + rootScore + weaponScore);
    },

    startTribulation() {
        this.data.isTribulating = true;
        document.getElementById('tribulation-overlay').classList.remove('hidden');
        document.getElementById('trib-console').innerHTML = '';
        document.getElementById('trib-hp-bar').style.width = '100%';
        document.getElementById('trib-hp-text').innerText = '100%';
        this.runTribulation();
    },

    async runTribulation() {
        const log = (m, c='#fff') => {
            const d = document.getElementById('trib-console');
            d.innerHTML += `<div style="color:${c}; margin-bottom:2px;">${m}</div>`;
            d.scrollTop = d.scrollHeight;
        };
        const thunder = document.getElementById('thunder-vfx');
        const countDisp = document.getElementById('trib-step');
        
        const playerProtection = this.getProtectionScore();
        log(`æŠ¤ä½“ç¥å…‰å¼ºåº¦: ${playerProtection.toFixed(1)}/100`, "#00f2ff");

        let survived = true;
        let hp = 100;
        
        for(let i=1; i<=100; i++) {
            countDisp.innerText = `${i} / 100 é“`;
            
            const difficulty = i - 1; 
            const baseChance = 100 - difficulty; 
            const finalChance = baseChance + playerProtection;
            
            const roll = Math.random() * 100;
            
            thunder.classList.add('thunder-strike');
            setTimeout(()=>thunder.classList.remove('thunder-strike'), 30);
            
            if (roll > finalChance) {
                log(`ç¬¬ ${i} é“: æŠ¤ä½“å‡»ç©¿!`, "#ff3b30");
                survived = false;
                break;
            } else {
                if(i % 20 === 0 || i === 1) log(`ç¬¬ ${i} é“: æˆåŠŸæŠµå¾¡`, "#888");
            }
            
            hp = 100 - i;
            document.getElementById('trib-hp-bar').style.width = hp + '%';
            document.getElementById('trib-hp-text').innerText = hp + '%';

            await this.sleep(40);
        }

        if(survived) {
            log("æ¸¡åŠ«æˆåŠŸï¼Œè‚‰èº«æˆåœ£ï¼", "#4caf50");
            await this.sleep(1000);
            this.handleWin();
        } else {
            log("é­‚é£é­„æ•£...", "#ff0000");
            await this.sleep(1000);
            this.handleDeath();
        }
    },

    handleWin() {
        this.data.isTribulating = false;
        document.getElementById('tribulation-overlay').classList.add('hidden');
        this.data.realmIdx++; 
        this.data.layer = 1;
        document.getElementById('modal-end').classList.remove('hidden');
        document.getElementById('end-title').innerText = "ç»ä¸–æ— åŒ";
        document.getElementById('end-title').style.color = "#ffd700";
        document.getElementById('end-desc').innerText = `æ­å–œé“å‹ ${this.data.name} è¯é“çœŸä»™ï¼Œç»ä¸–æ— åŒï¼`;
    },

    handleDeath() {
        this.data.isTribulating = false;
        document.getElementById('tribulation-overlay').classList.add('hidden');
        document.getElementById('modal-end').classList.remove('hidden');
        document.getElementById('end-title').innerText = "é“æ¶ˆèº«æ­»";
        document.getElementById('end-title').style.color = "#ff3b30";
        document.getElementById('end-desc').innerText = "å¤©å¨éš¾æµ‹ï¼Œè¯·é‡æ–°æ¥è¿‡ã€‚";
    },

    reincarnate() {
        this.data.reincarnationCount++;
        this.data.spirit = 0;
        this.data.realmIdx = 0;
        this.data.layer = 1;
        this.data.rootIdx = 0; this.data.rootFails = 0;
        this.data.weaponIdx = 0; this.data.weaponFails = 0;
        this.data.skills.forEach(s => s.level = Math.floor(s.level * 0.5)); 
        
        document.getElementById('modal-end').classList.add('hidden');
        ui.log(`è½®å›ç¬¬ ${this.data.reincarnationCount} ä¸–ï¼Œé‡æ–°è¸ä¸Šå¾ç¨‹ã€‚`, 'rare-purple');
        ui.render();
    },

    sleep(ms) { return new Promise(r=>setTimeout(r,ms)); },
    loop() { requestAnimationFrame(()=>this.loop()); }
};

const ui = {
    skillHoldTimer: null,

    init() {
        const area = document.getElementById('click-area');
        const start = (e) => {
            if(e.cancelable) e.preventDefault();
            if(game.hold.active) return;
            game.hold.active = true;
            game.hold.startTime = Date.now();
            document.getElementById('avatar').classList.add('channeling');
            document.getElementById('channel-container').classList.add('active');
            game.hold.timer = setInterval(() => { this.updateHoldStatus(); game.processClick(null); }, 100);
        };
        const end = () => {
            if(!game.hold.active) return;
            game.hold.active = false;
            clearInterval(game.hold.timer);
            game.hold.currentMult = 1; 
            document.getElementById('avatar').classList.remove('channeling');
            document.getElementById('channel-container').classList.remove('active');
            document.getElementById('channel-text').innerText = '';
            document.getElementById('channel-fill').style.width = '0%';
        };

        area.addEventListener('mousedown', start);
        area.addEventListener('touchstart', start, {passive:false});
        document.addEventListener('mouseup', end);
        document.addEventListener('touchend', end);
        
        this.render();
    },

    updateHoldStatus() {
        const now = Date.now();
        const diff = (now - game.hold.startTime) / 1000; 
        const index = Math.floor(diff / 5);
        game.hold.currentMult = (index + 1) * 10;
        const percent = ((diff % 5) / 5) * 100;
        document.getElementById('channel-fill').style.width = percent + '%';
        document.getElementById('channel-text').innerHTML = `åŸå”± ${diff.toFixed(1)}s <span style="color:#ffeb3b; margin-left:10px;">x${game.hold.currentMult}å€</span>`;
        if(index >= 1) {
            const shake = Math.random() * (index * 1.5);
            document.getElementById('avatar').style.transform = `scale(1.05) translate(${shake}px, ${shake}px)`;
        }
    },

    startSkillHold(idx) {
        if(this.skillHoldTimer) clearInterval(this.skillHoldTimer);
        game.upgradeSkill(idx);
        this.renderSkills(); 
        this.renderCultivate(); 
        this.updateSpirit();
        this.skillHoldTimer = setInterval(() => {
            const success = game.upgradeSkill(idx);
            if(success) {
                this.renderSkills(); 
                this.updateSpirit();
            } else {
                clearInterval(this.skillHoldTimer);
            }
        }, 80);
    },
    endSkillHold() {
        if(this.skillHoldTimer) { clearInterval(this.skillHoldTimer); this.skillHoldTimer = null; }
    },

    fmt(num) {
        if(num < 10000) return Math.floor(num);
        if(num < 100000000) return (num/10000).toFixed(2) + 'ä¸‡';
        if(num < 1000000000000) return (num/100000000).toFixed(2) + 'äº¿';
        if(num < 10000000000000000) return (num/1000000000000).toFixed(2) + 'å…†';
        if(num < 100000000000000000000) return (num/10000000000000000).toFixed(2) + 'äº¬';
        return "âˆ";
    },

    switchTab(t) {
        document.querySelectorAll('.tab-content').forEach(d=>d.classList.remove('show'));
        document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
        document.getElementById('tab-'+t).classList.add('show');
        event.target.classList.add('active');
    },

    log(msg, c='#aaa') {
        const d = document.getElementById('gamelog');
        d.innerHTML = `<div style="color:${c}; margin-bottom:6px; border-bottom:1px solid rgba(255,255,255,0.05); padding-bottom:2px;">[${new Date().toLocaleTimeString().split(' ')[0]}] ${msg}</div>` + d.innerHTML;
    },

    showFloatText(x, y, num) {
        const el = document.createElement('div');
        el.className = 'float-text';
        el.style.left = (x - 20) + 'px';
        el.style.top = (y - 50) + 'px';
        el.innerText = '+' + this.fmt(num);
        document.body.appendChild(el);
        setTimeout(()=>el.remove(), 800);
    },
    
    bgParticle(x, y) {
        const canvas = document.getElementById('bgCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        ctx.fillStyle = 'rgba(0, 242, 255, 0.3)';
        ctx.beginPath();
        ctx.arc(x, y, 6, 0, Math.PI*2);
        ctx.fill();
        setTimeout(()=> ctx.clearRect(0,0,canvas.width,canvas.height), 150);
    },

    render() {
        document.getElementById('player-name').innerText = game.data.name;
        document.getElementById('reincarnate-count').innerText = game.data.reincarnationCount;
        
        const root = CONFIG.ROOTS[game.data.rootIdx];
        const weapon = CONFIG.WEAPONS[game.data.weaponIdx];
        
        const tDisp = document.getElementById('talent-disp');
        tDisp.innerText = root.tag; 
        tDisp.className = 'tag-badge ' + (game.data.rootIdx >= 9 ? 'god' : (game.data.rootIdx >= 6 ? 'rare' : ''));
        
        const wDisp = document.getElementById('weapon-disp');
        wDisp.innerText = weapon.tag;
        wDisp.className = 'tag-badge ' + (game.data.weaponIdx >= 9 ? 'god' : (game.data.weaponIdx >= 6 ? 'rare' : ''));

        const rName = CONFIG.MAJOR_REALMS[game.data.realmIdx].name;
        const lName = game.data.realmIdx < 9 ? ` ${game.data.layer}å±‚` : "";
        document.getElementById('realm-disp').innerText = rName + lName;
        
        this.updateSpirit();
        this.renderSkills();
        this.renderCultivate();
    },

    updateSpirit() {
        document.getElementById('spirit-disp').innerText = this.fmt(game.data.spirit);
    },

    renderSkills() {
        const div = document.getElementById('skills-list');
        div.innerHTML = '';
        game.data.skills.forEach((s,i) => {
            const cost = s.cost * Math.pow(1.6, s.level);
            const canBuy = game.data.spirit >= cost;
            const isMax = s.level >= 100;
            
            let displayName = s.name;
            if(isMax) displayName = `<span style="color:var(--rare-purple);font-weight:bold;text-shadow:0 0 5px var(--rare-purple)">è‡³è‡»Â·${s.name}</span>`;

            div.innerHTML += `
                <div class="list-item">
                    <div style="flex:1; padding-right:10px;">
                        <div style="font-weight:bold; color:${isMax?'var(--primary-gold)':'#eee'}; font-size:0.9rem;">
                            ${displayName} <span style="font-size:0.75rem; color:#666; margin-left:5px;">Lv.${s.level}</span>
                        </div>
                        <div style="font-size:0.7rem; color:#555; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-top:2px;">${s.desc}</div>
                    </div>
                    <button class="btn-upgrade ${isMax?'maxed':''}" ${canBuy?'':'disabled'} 
                        onmousedown="ui.startSkillHold(${i})" onmouseup="ui.endSkillHold()" onmouseleave="ui.endSkillHold()"
                        ontouchstart="ui.startSkillHold(${i})" ontouchend="ui.endSkillHold()">
                        ${isMax ? 'çªç ´' : 'å‡çº§'} <br><span style="font-size:0.6rem">${this.fmt(cost)}</span>
                    </button>
                </div>
            `;
        });
    },

    renderCultivate() {
        const idx = game.data.realmIdx;
        const layer = game.data.layer;
        const nextReq = game.getNextRealmReq();
        const btnU = document.getElementById('btn-realm');
        const btnT = document.getElementById('btn-trib');
        const tribWarn = document.getElementById('trib-warn');
        
        if(idx >= 9) {
            document.getElementById('next-realm-name').innerText = "å·²è‡»åŒ–å¢ƒ";
            document.getElementById('req-realm').innerText = "-";
            btnU.classList.add('hidden');
            btnT.classList.add('hidden');
            tribWarn.classList.add('hidden');
        } else {
            let nextNameStr = layer < 9 ? `${CONFIG.MAJOR_REALMS[idx].name} ${layer+1}å±‚` : `${CONFIG.MAJOR_REALMS[idx+1].name} ä¸€å±‚`;
            document.getElementById('next-realm-name').innerText = nextNameStr;
            document.getElementById('req-realm').innerText = this.fmt(nextReq);

            if(idx === 8 && layer === 9) {
                btnU.classList.add('hidden');
                btnT.classList.remove('hidden');
                tribWarn.classList.remove('hidden');
                document.getElementById('protect-val-preview').innerText = game.getProtectionScore().toFixed(1) + "%";

                btnT.disabled = game.data.spirit < nextReq;
                if(game.data.spirit < nextReq) { btnT.style.opacity = 0.5; btnT.innerText = "çµåŠ›ä¸è¶³"; }
                else { btnT.style.opacity = 1; btnT.innerText = "é€†å¤©æ”¹å‘½ (ç™¾é›·å¤©åŠ«)"; }
            } else {
                btnU.classList.remove('hidden');
                btnT.classList.add('hidden');
                tribWarn.classList.add('hidden');
                if(game.data.spirit >= nextReq) {
                    btnU.className = "cultivate-btn-lg active risk"; 
                    btnU.innerText = "çªç ´ç“¶é¢ˆ (80%)";
                } else {
                    btnU.className = "cultivate-btn-lg";
                    btnU.innerText = "ç§¯æ”’çµåŠ›ä¸­...";
                }
            }
        }

        const rIdx = game.data.rootIdx;
        const btnRoot = document.getElementById('btn-root');
        
        if(rIdx >= CONFIG.ROOTS.length - 1) {
            document.getElementById('next-root-name').innerText = "å·²è¾¾æé™";
            document.getElementById('root-bonus').innerText = "MAX";
            document.getElementById('req-root').innerText = "-";
            btnRoot.disabled = true;
            btnRoot.innerText = "åœ†æ»¡";
            btnRoot.className = "cultivate-btn-lg";
        } else {
            const nextR = CONFIG.ROOTS[rIdx + 1];
            document.getElementById('next-root-name').innerText = nextR.name;
            document.getElementById('root-bonus').innerText = `x${nextR.mult}`;
            document.getElementById('req-root').innerText = this.fmt(nextR.cost);
            if(game.data.spirit >= nextR.cost) {
                btnRoot.className = "cultivate-btn-lg active risk"; 
                btnRoot.innerText = "æ´—é«“ä¼éª¨ (80%)";
            } else {
                btnRoot.className = "cultivate-btn-lg";
                btnRoot.innerText = "çµåŠ›ä¸è¶³";
            }
        }

        const wIdx = game.data.weaponIdx;
        const btnW = document.getElementById('btn-weapon');

        if(wIdx >= CONFIG.WEAPONS.length - 1) {
            document.getElementById('next-weapon-name').innerText = "ç¥å™¨å·²æˆ";
            document.getElementById('weapon-bonus').innerText = "MAX";
            document.getElementById('req-weapon').innerText = "-";
            btnW.disabled = true;
            btnW.innerText = "åœ†æ»¡";
            btnW.className = "cultivate-btn-lg";
        } else {
            const nextW = CONFIG.WEAPONS[wIdx + 1];
            document.getElementById('next-weapon-name').innerText = nextW.name;
            document.getElementById('weapon-bonus').innerText = `x${nextW.mult}`;
            document.getElementById('req-weapon').innerText = this.fmt(nextW.cost);
            if(game.data.spirit >= nextW.cost) {
                btnW.className = "cultivate-btn-lg active risk";
                btnW.innerText = "ç¥­ç‚¼æ³•å® (80%)";
            } else {
                btnW.className = "cultivate-btn-lg";
                btnW.innerText = "çµåŠ›ä¸è¶³";
            }
        }
    }
};

window.onload = game.init.bind(game);
</script>
</body>
</html>
